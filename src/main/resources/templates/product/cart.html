<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë¡¯ë°ON::ë¡¯ë° ì˜¨ë¼ì¸ ì‡¼í•‘ëª°</title>
    <link rel="shortcut icon" type="image/x-icon" th:href="@{/images/favicon.ico}" />
    <script th:src="@{https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js}"></script>
    <script th:src="@{https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js}"></script>
    <script th:src="@{https://kit.fontawesome.com/20962f3e4b.js}" crossorigin="anonymous"></script>
    <script th:src="@{https://cdn.jsdelivr.net/bxslider/4.2.12/jquery.bxslider.min.js}"></script>
    <link rel="stylesheet" th:href="@{https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css}"/>
    <link rel="stylesheet" th:href="@{https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css}"/>
    <link rel="stylesheet" th:href="@{https://cdn.jsdelivr.net/bxslider/4.2.12/jquery.bxslider.css}"/>
    <link rel="stylesheet" th:href="@{/css/common.css}" />
    <link rel="stylesheet" th:href="@{/css/product/product.css}" />
    <!--cart í˜ì´ì§€ëŠ” ì¹´í…Œê³ ë¦¬ íƒ­ì´ ì—†ì–´ì•¼í•˜ë¯€ë¡œ layoutì²˜ë¦¬ ì•ˆí•¨-->

    <script>
        window.onload = function (){

            const cartDelete = document.getElementById('cartDelete');


            // ë”œë¦¬íŠ¸ ë²„íŠ¼ í´ë¦­ì‹œ ì‚­ì œ ë¡œì§
            cartDelete.onclick = function (e){
                e.preventDefault();
                var selectedCart = document.getElementsByName('selectedCart');
                var selectedCartList = [];
                var rowsToDelete = [];

                selectedCart.forEach(function (checkbox) {
                    if (checkbox.checked){
                        var inputField = checkbox.parentNode.querySelector('input[type="hidden"]');
                        var cartProdNo = inputField.value;
                        selectedCartList.push(cartProdNo);
                        var row = checkbox.closest('.productList');
                        rowsToDelete.push(row);
                    }
                });
                console.log('Selected Cart Product Numbers:', selectedCartList);
                console.log('Rows to Delete:', rowsToDelete);

                console.log(selectedCartList);
                var result = confirm("ì¥ë°”êµ¬ë‹ˆì—ì„œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
                if (result){
                    const jsonDate = {
                        cartProdNo : selectedCartList
                    };
                    fetchPut(`/lotteon/cart/delete`, jsonDate)
                        .then(data => {
                            console.log(data); // ì„œë²„ë¡œë¶€í„° ë°›ì€ ë°ì´í„° ì¶œë ¥ ë˜ëŠ” ì²˜ë¦¬
                            alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");

                            rowsToDelete.forEach(function (row) {

                                row.remove();

                                var org_prices = document.querySelectorAll('.sum_org_price');
                                var del_prices = document.querySelectorAll('.delivery_price');
                                var dis_prices = document.querySelectorAll('.discount_price');
                                var tot_prices = document.querySelectorAll('.total_price');

                                console.log(org_prices.innerHTML + "/" +  del_prices.innerHTML + "/" + dis_prices.innerHTML + "/" + tot_prices.innerHTML);
                                // íšŒì‚¬ë³„ ìƒí’ˆ ê°€ê²© ì¶œë ¥
                                org_prices.forEach(function (org_price) {
                                    org_price.textContent = ' ìƒí’ˆ 0ì›';
                                });

                                del_prices.forEach(function (del_price) {
                                    del_price.textContent = ' + ë°°ì†¡ë¹„ 0ì›';
                                });

                                dis_prices.forEach(function (dis_price) {
                                    dis_price.textContent = ' - í• ì¸ 0ì›';
                                });

                                tot_prices.forEach(function (tot_price) {
                                    tot_price.textContent = ' = ì´ 0ì›';
                                });

                                const cartOrg = document.getElementById('prodOrgPrice');
                                const cartCount = document.getElementById('prodCount');
                                const cartDis = document.getElementById('prodDisPrice');
                                const cartDel = document.getElementById('prodDelivery');
                                const cartPoi = document.getElementById('prodPoint');
                                const cartTotal = document.getElementById('prodTotalPrice');

                                cartOrg.textContent = '0';
                                cartCount.textContent = '0';
                                cartDis.textContent = '0';
                                cartDel.textContent = '- 0';
                                cartPoi.textContent = '0';
                                cartTotal.textContent = '0';

                            });

                            // productListê°€ ëª¨ë‘ ì‚­ì œë˜ì—ˆì„ ë•Œ listForCompany í´ë˜ìŠ¤ì˜ ìƒíƒœ í™•ì¸
                            var listForCompanyList = document.querySelectorAll('.listForCompany');
                            listForCompanyList.forEach(function (listForCompany) {
                                var productList = listForCompany.querySelectorAll('.productList');
                                if (productList.length === 0) {
                                    // productListê°€ ì—†ìœ¼ë©´ ë¶€ëª¨ ìš”ì†Œì¸ listForCompanyë„ ì‚­ì œ
                                    listForCompany.remove();
                                }
                            });


                        })
                        .catch(error => {
                            console.error(error); // ì˜¤ë¥˜ ì²˜ë¦¬
                        });
                }
            }

            const orderBtn = document.getElementById('btnOrder');

            orderBtn.onclick = function (e){
                e.preventDefault();
                if (document.getElementById('prodCount').innerText === "0"){
                    alert('ì£¼ë¬¸ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                }else {
                    if (confirm('ìƒí’ˆì„ ê²°ì œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
                        var selectedCart = document.getElementsByName('selectedCart');
                        const userId = document.getElementById('userForDirect').value;
                        var selectedCartList = [];
                        var selectedCountList = [];

                        selectedCart.forEach(function (checkbox) {
                            if (checkbox.checked){
                                var inputField = checkbox.parentNode.querySelector('input[type="hidden"]');
                                var cartProdNo = inputField.value;
                                selectedCartList.push(cartProdNo);
                                var inputCount = checkbox.parentNode.querySelector('.prodCount');
                                var countValue = inputCount.value;
                                selectedCountList.push(countValue);
                            }
                        });

                        console.log(selectedCartList);
                        console.log(selectedCountList);

                        const jsonDate = {
                            cartProdNo : selectedCartList,
                            count : selectedCountList
                        };

                        fetchPut(`/lotteon/cart/update`, jsonDate)
                            .then(data => {
                                console.log(data); // ì„œë²„ë¡œë¶€í„° ë°›ì€ ë°ì´í„° ì¶œë ¥ ë˜ëŠ” ì²˜ë¦¬

                                var selectedProdInput = document.getElementById('selectedProd');
                                selectedProdInput.value = selectedCartList.join(',');
                                const form = document.getElementById('buyForm');
                                form.submit();

                            })
                            .catch(error => {
                                console.error(error); // ì˜¤ë¥˜ ì²˜ë¦¬
                            });
                    }
                }
            }
        }

        /* 3ì¼í›„ ê³„ì‚°í•˜ì—¬ ë°°ì†¡ì˜ˆì •ì¼ì— ì¶œë ¥ */
        document.addEventListener('DOMContentLoaded', function () {
            // ì˜¤ëŠ˜ ë‚ ì§œ êµ¬í•˜ê¸°
            var today = new Date();

            // 3ì¼ í›„ì˜ ë‚ ì§œ ê³„ì‚°
            var deliveryDate = new Date(today);
            deliveryDate.setDate(today.getDate() + 3); // ì˜¤ëŠ˜ ë‚ ì§œì— 3ì¼ì„ ë”í•¨

            // ë„ì°© ì˜ˆì • ë‚ ì§œ í˜•ì‹ ì§€ì •
            var dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            var dayOfWeek = dayNames[deliveryDate.getDay()]; // ìš”ì¼
            var month = deliveryDate.getMonth() + 1; // ì›” (0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ +1 í•„ìš”)
            var dayOfMonth = deliveryDate.getDate(); // ì¼

            // ë„ì°© ì˜ˆì • ë‚ ì§œ ë¬¸ìì—´ ìƒì„± (ì˜ˆ: "7/8(ê¸ˆ) ì´ë‚´ ë„ì°©í™•ë¥  86%")
            var arrivalDateString = `${month}/${dayOfMonth}(${dayOfWeek})ì´ë‚´ ë„ì°©í™•ë¥  86%`;

            // ë„ì°© ì˜ˆì • ë‚ ì§œ ì¶œë ¥
            var productListElements = document.querySelectorAll('.productList');
            productListElements.forEach(function (element){
                var arrivalElement = element.querySelector('#arrivalDate');
                arrivalElement.textContent = arrivalDateString;
            });

        });

        // xë²„íŠ¼
        function cartProdDelete(){
            var inputField = event.target.parentNode.nextElementSibling.querySelector('input[type="hidden"]');
            var cartProdNoList = [];
            var cartProdNo = inputField.value;
            cartProdNoList.push(cartProdNo);
            var row = event.target.closest('.productList');
            console.log("1 :" + row);


            var result = confirm("ì¥ë°”êµ¬ë‹ˆì—ì„œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
            if (result){
                const jsonDate = {
                    cartProdNo : cartProdNoList
                };
                fetchPut(`/lotteon/cart/delete`, jsonDate)
                    .then(data => {
                        console.log(data); // ì„œë²„ë¡œë¶€í„° ë°›ì€ ë°ì´í„° ì¶œë ¥ ë˜ëŠ” ì²˜ë¦¬
                        alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                        row.remove();

                        // productListê°€ ëª¨ë‘ ì‚­ì œë˜ì—ˆì„ ë•Œ listForCompany í´ë˜ìŠ¤ì˜ ìƒíƒœ í™•ì¸
                        var listForCompanyList = document.querySelectorAll('.listForCompany');
                        listForCompanyList.forEach(function (listForCompany) {
                            var productList = listForCompany.querySelectorAll('.productList');
                            if (productList.length === 0) {
                                // productListê°€ ì—†ìœ¼ë©´ ë¶€ëª¨ ìš”ì†Œì¸ listForCompanyë„ ì‚­ì œ
                                listForCompany.remove();
                            }
                        });



                    })
                    .catch(error => {
                        console.error(error); // ì˜¤ë¥˜ ì²˜ë¦¬
                    });
            }
        }

        /* +, - ë²„íŠ¼ ëˆŒë €ì„ ë•Œ ë™ì‘í•˜ë©° í• ì¸ ê¸ˆì•¡ ê³„ì‚°í•˜ì—¬ ì´ ì•¡ì—ë‚˜íƒ€ë‚˜ê²Œí•¨ */
        function changeNum(change) {
            var numInput = event.target.parentNode.querySelector('input');
            var productInfo = event.target.closest('.productInfo');
            // í• ì¸ ì „,í›„ ê°€ê²© ìš”ì†Œ ì„ íƒ
            var orgPriceElement = productInfo.querySelector('.org_price span');
            var inputOrgPrice = productInfo.querySelector('.org_price input.price');
            var disPriceElement = productInfo.querySelector('.dis_price');
            var discount = productInfo.querySelector('.dis_prod').value;
            //var inputOrgElement = orgPriceElement.querySelector('input');
            //console.log(inputOrgPrice);
            //console.log("discount:"+discount);

            var orgPriceValue = inputOrgPrice.value;
            //console.log("org :" + orgPriceValue);

            var currentValue = parseInt(numInput.value) + change;
            // ìµœì†Œê°’ì€ 1, ìµœëŒ€ê°’ì€ 99ë¡œ ì œí•œ
            if (currentValue < 1) {
                currentValue = 1;
            } else if (currentValue > 99) {
                currentValue = 99;
            }

            numInput.value = currentValue; // ë³€ê²½ëœ ê°’ ì ìš©
            //console.log("ê°¯ìˆ˜"+currentValue);

            var orgTotalPrice = orgPriceValue * currentValue;
            var disTotalPrice = orgPriceValue *(100 - discount) * currentValue * 0.01;
            //console.log("ì›ê¸ˆ"+orgTotalPrice);
            //console.log("í• ì¸"+disTotalPrice);
            if (!isNaN(orgTotalPrice)) {
                // ê¸ˆì•¡ ì½¤ë§ˆ í‘œì‹œë¥¼ ìœ„í•´ í¬ë©§íŒ…
                var fOrgTotalPrive = new Intl.NumberFormat('ko-KR').format(orgTotalPrice)+'ì›';
                orgPriceElement.innerHTML = fOrgTotalPrive;

            }
            if (!isNaN(disTotalPrice)){
                var fDisTotalPrive = new Intl.NumberFormat('ko-KR').format(disTotalPrice)+'ì›';
                disPriceElement.innerHTML = fDisTotalPrive;
            }

            // ìˆ˜ëŸ‰ ì¡°ì ˆí•œ ìƒí’ˆì˜ ì²´í¬ë°•ìŠ¤ê°€ ì²´í¬ ë˜ì—ˆëŠ”ì§€ í™•ì¸

            // ì²´í¬ ë˜ì—ˆìœ¼ë©´ í•©ì‚° ê°€ê²© ì¡°ì •
            var aa = event.target.parentNode.parentNode.parentNode.parentNode.parentNode;
            calculateTotalPrice(aa);
            // ì²´í¬ ì•ˆë˜ë©´ ë

        }

        // ì²´í¬ ëœ ìƒí’ˆ ê¸ˆì•¡ ê³„ì‚°
        function calculateTotalPrice(aa){

            //console.log("calculateTotalPrice...1 : " + this);
            // íšŒì‚¬ë³„ë¡œ ê°€ê²© ì¶œë ¥
            let sumOrgPrice = 0;
            let discountPrice = 0;
            let sumTotalPrice = 0;
            let deliveryFeeList = [];
            let maxDeliveryFee = 0;
            let listForCompany = aa;


            //console.log("listForCompany : " + listForCompany);

            if (aa === undefined) {
                //console.log("2" + listForCompany);
                listForCompany = event.target.parentNode.parentNode.parentNode;
            }
            //console.log("3" + listForCompany);
            // ì„ íƒëœ ì²´í¬ë°•ìŠ¤ ê°¯ìˆ˜ì¹´ìš´íŠ¸ë¥¼ ìœ„í•œ ë¬¸ì„œê°ì²´
            var selectedCheckboxes = document.querySelectorAll('input[name="selectedCart"]:checked');
            var checkedCount = selectedCheckboxes.length;
            //console.log("ì„ íƒëœ ìƒí’ˆ ê°œìˆ˜: " + checkedCount);
            const prodCount = document.getElementById('prodCount');
            prodCount.textContent = checkedCount.toLocaleString();
            const listForCompanyChecks = listForCompany.querySelectorAll('input[name="selectedCart"]');

            listForCompanyChecks.forEach(function (checkbox){

                //const listForCompany = checkbox.closest('.listForCompany');
                //console.log("calculateTotalPrice...2 : " + listForCompany);

                const orgPrice = listForCompany.querySelector('.sum_org_price');
                const disPrice = listForCompany.querySelector('.discount_price');
                const deliveryPrice = listForCompany.querySelector('.delivery_price');
                const totalPrice = listForCompany.querySelector('.total_price');

                //console.log("ì›ê¸ˆ :" + orgPrice + "í• ì¸" + disPrice + "í•© :" + totalPrice);

                if (checkbox.checked){

                    //console.log("calculateTotalPrice...3");
                    const cartItem = checkbox.closest('.productInfo');
                    const priceOrgElement = cartItem.querySelector('.org_price_value');
                    const priceDisElement = cartItem.querySelector('.dis_price');
                    const deliveryPrice = cartItem.querySelector('.delivery_fee');
                    // console.log(deliveryPrice);

                    if (deliveryPrice.value){
                        deliveryFeeList.push(deliveryPrice.value);
                    }

                    maxDeliveryFee = Math.max(...deliveryFeeList);
                    console.log("ìµœëŒ€ ë°°ì†¡ë¹„ : " + maxDeliveryFee);

                    //console.log(cartItem.innerHTML);
                    console.log("orgin: " + priceOrgElement.innerHTML + ", dis :" + priceDisElement.innerHTML);

                    const orgPriceText = priceOrgElement.innerText; // ì²´í¬ëœ ìƒí’ˆì˜ ê°€ê²©
                    const disPriceText = priceDisElement.innerText; // ì²´í¬ëœ ìƒí’ˆì˜ ê°€ê²©
                    console.log("í• ì¸ê°€í…ìŠ¤íŠ¸ :" + disPriceText);
                    var orgParsePrice = parseFloat(orgPriceText.replace(/,/g, ''));
                    var disParsePrice = parseFloat(disPriceText.replace(/,/g, ''));
                    console.log("ë‹¨ìˆœê³„ì‚° : ì›ê¸ˆ :" + orgParsePrice + ", dis :" + disParsePrice + ", fee :" + maxDeliveryFee);

                    sumOrgPrice += orgParsePrice;
                    discountPrice += orgParsePrice - disParsePrice;
                    sumTotalPrice = sumOrgPrice - discountPrice; // ìµœì¢… ê°€ê²©
                    if (sumTotalPrice >= 50000) {
                        maxDeliveryFee = 0;
                        sumTotalPrice = sumOrgPrice - discountPrice + maxDeliveryFee; // ì¡°ì •ëœ ìµœì¢… ê°€ê²© ë‹¤ì‹œ ê³„ì‚°
                    }else {
                        sumTotalPrice = sumOrgPrice - discountPrice + maxDeliveryFee;
                    }

                }
                // íšŒì‚¬ë³„ ìƒí’ˆ ê°€ê²© ì¶œë ¥
                orgPrice.textContent = ' ìƒí’ˆ ' + sumOrgPrice.toLocaleString() + 'ì›';
                deliveryPrice.textContent = ' + ë°°ì†¡ë¹„' + maxDeliveryFee.toLocaleString() + 'ì›';
                disPrice.textContent = ' - í• ì¸ ' + discountPrice.toLocaleString() + 'ì›';
                totalPrice.textContent = ' = ì´ ' + sumTotalPrice.toLocaleString() + 'ì›';
                console.log("íšŒì‚¬ë³„ê°€ê²©: "+orgPrice.innerHTML + " : " + disPrice.innerHTML + " : " + totalPrice.innerHTML);
            });
            cartPrice();
        }

        // ì „ì²´ ì²´í¬ ì„ íƒ ì‹œ ê¸ˆì•¡ ê³„ì‚°
        function allCheckedBoxTotalPrice() {
            const cartList = event.target.parentNode.parentNode;
            const list = document.querySelectorAll('.listForCompany');
            const allCheckbox = document.querySelector('input[name="all"]');
            const selectedCartCheckboxes = document.querySelectorAll('input[name="selectedCart"]');
            selectedCartCheckboxes.forEach(function (checkbox){
                checkbox.checked = allCheckbox.checked;
            });
            Array.from(list).forEach(function (eachList) {
                calculateTotalPrice(eachList);

            });
        }

        // íŒë§¤ íšŒì‚¬ ë³„ ê¸ˆì•¡ ê³„ì‚°
        function cartPrice(){
            const allSelectedPrice = document.querySelectorAll('.company_price');
            //console.log(allSelectedPrice);

            // ì „ì²´í•©ê³„
            let cartOrgPrice = 0;
            let cartDisPrice = 0;
            let cartDeliveryPrice = 0;
            let cartPoint = 0;
            let cartTotalPrice = 0;

            allSelectedPrice.forEach(function (priceElement){
                const orgPrice = priceElement.querySelector('.sum_org_price');
                const disPrice = priceElement.querySelector('.discount_price');
                const deliveryPrice = priceElement.querySelector('.delivery_price');
                const totalPrice = priceElement.querySelector('.total_price');

                // ê° ìš”ì†Œì—ì„œ í…ìŠ¤íŠ¸ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
                const orgPriceText = orgPrice.textContent.trim();
                const disPriceText = disPrice.textContent.trim();
                const deliveryPriceText = deliveryPrice.textContent.trim();
                const totalPriceText = totalPrice.textContent.trim();

                // ê° í…ìŠ¤íŠ¸ì—ì„œ ìˆ«ì ê°’ ì¶”ì¶œ
                const orgPriceValue = parseFloat(orgPriceText.replace(/[^\d.-]/g, '')); // ìˆ«ìë¡œ ë³€í™˜
                const disPriceValue = parseFloat(disPriceText.replace(/[^\d.-]/g, '')); // ìˆ«ìë¡œ ë³€í™˜
                const deliveryPriceValue = parseFloat(deliveryPriceText.replace(/[^\d.-]/g, '')); // ìˆ«ìë¡œ ë³€í™˜
                const totalPriceValue = parseFloat(totalPriceText.replace(/[^\d.-]/g, '')); // ìˆ«ìë¡œ ë³€í™˜

                //console.log(orgPriceValue + "/" + disPriceValue + "/" + deliveryPriceValue + "/" + totalPriceValue);

                cartOrgPrice += orgPriceValue;
                cartDisPrice += disPriceValue;
                cartDeliveryPrice += deliveryPriceValue;
                cartTotalPrice += totalPriceValue;
                cartPoint = Math.floor(cartTotalPrice * 0.01);

                //console.log(cartOrgPrice + "/" + cartDisPrice + "/" + cartDeliveryPrice + "/" + cartTotalPrice);
            });

            const cartOrg = document.getElementById('prodOrgPrice');
            const cartDis = document.getElementById('prodDisPrice');
            const cartDel = document.getElementById('prodDelivery');
            const cartPoi = document.getElementById('prodPoint');
            const cartTotal = document.getElementById('prodTotalPrice');

            cartOrg.textContent = cartOrgPrice.toLocaleString();
            cartDis.textContent = cartDisPrice.toLocaleString();
            cartDel.textContent = cartDeliveryPrice.toLocaleString();
            cartPoi.textContent = cartPoint.toLocaleString();
            cartTotal.textContent = cartTotalPrice.toLocaleString();
        }

        function accordion() {
            const button = event.target;
            const listForCompany = button.parentNode;
            const productListAll = listForCompany.querySelectorAll('.productList');
            const company_price = listForCompany.querySelector('.company_price');
            Array.from(productListAll).forEach(function (productList) {
                if (productList.style.display === "none") {
                    productList.style.display = "flex";
                    //company_price.style.display = "flex";
                    button.innerText = "âˆ§";
                }else {
                    productList.style.display = "none";
                    //company_price.style.display = "none";
                    button.innerText = "âˆ¨";
                }
            })
        }

        // top ë²„íŠ¼
        function movingTop() {
            window.scrollTo(0, 0);
        }

    </script>

</head>
<body>
<div id="wrapper">
    <header>
        <div class="top">
            <div th:if="${!#authorization.expression('isAuthenticated()')}">
                <a th:href="@{/member/login}">ë¡œê·¸ì¸</a>
                <a th:href="@{/member/join}">íšŒì›ê°€ì…</a>
            </div>
            <div th:if="${#authorization.expression('isAuthenticated()')}">
                <a th:href="@{/member/join}">[[${#authentication.principal.user.userName}]]ë‹˜</a>
                <a th:href="@{/my/home(userId=${#authentication.principal.user.userId})}">ë§ˆì´í˜ì´ì§€</a>
                <a th:href="@{/product/cart(userId=${#authentication.principal.user.userId})}">
                    <i class="fa fa-shopping-cart" aria-hidden="true"></i>&nbsp;ì¥ë°”êµ¬ë‹ˆ
                </a>
                <a th:href="@{/member/logout}">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </div>
        <div class="logo">
            <div>
                <a th:href="@{/}"><img th:src="@{/images/header_logo.png}" alt="ë¡œê³ " /></a>
                <form action="#">
                    <input type="text" name="search"/>
                    <button><i class="fa fa-search"></i></button>
                </form>
            </div>

        </div>
        <div class="menu">
            <div>
                <ul>
                    <li><a th:href="@{'/product/list?cateCode='+'&sort=prodHit'}">íˆíŠ¸ìƒí’ˆ</a></li>
                    <li><a th:href="@{'/product/list?cateCode='+'&sort=prodScore'}">ì¶”ì²œìƒí’ˆ</a></li>
                    <li><a th:href="@{'/product/list?cateCode='+'&sort=prodRdate'}">ìµœì‹ ìƒí’ˆ</a></li>
                    <li><a th:href="@{'/product/list?cateCode='+'&sort=prodSold'}">ì¸ê¸°ìƒí’ˆ</a></li>
                    <li><a th:href="@{'/product/list?cateCode='+'&sort=prodDiscount'}">í• ì¸ìƒí’ˆ</a></li>
                </ul>
                <ul>
                    <li><a href="#">ì¿ í°ì¡´</a></li>
                    <li><a href="#">ì‚¬ìš©í›„ê¸°</a></li>
                    <li><a href="#">ê°œì¸ê²°ì œ</a></li>
                    <li><a th:href="@{/cs/index}">ê³ ê°ì„¼í„°</a></li>
                    <li><a th:href="@{/cs/faq/list(faqCate='user')}">FAQ</a></li>
                </ul>
            </div>
        </div>
    </header>
    <main id="product">

        <!-- ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ ì‹œì‘ -->
        <section class="cart">

            <!-- ì œëª©, í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ -->
            <nav>
                <script th:src="@{/js/util.js}"></script>
                <h1>ì¥ë°”êµ¬ë‹ˆ</h1>
                <p>
                    HOME > <span>íŒ¨ì…˜Â·ì˜ë¥˜Â·ë·°í‹°</span> > <strong>ì¥ë°”êµ¬ë‹ˆ</strong>
                </p>
            </nav>
            <div th:if="${cartProducts.size()==0}" id="cartList" >
                <div style="justify-content: center; align-items: center;  padding: 20px 0">
                    <p style="font-size: 16px; font-weight: bold;">ğŸ›’ ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ğŸ›’</p>
                </div>
            </div>
            <div th:if="${cartProducts.size()!=0}" id="cartList">
                <!-- ì¥ë°”êµ¬ë‹ˆ ëª©ë¡ -->
                <div>
                    <label for="">
                        <input type="checkbox" name="all" onclick="allCheckedBoxTotalPrice()">
                        <span>ì „ì²´ì„ íƒ</span>
                    </label>
                    <a href="" id="cartDelete">ì„ íƒì‚­ì œ</a>
                </div>
                <div class="listForCompany" th:each="map : ${cartProducts}" style="position: relative">
                    <p style="padding: 15px; border-top : 1px solid #d3d3d3; font-size: 18px; font-weight: bold; background-color: #f2f2f2 "  class="cartProdCompany" th:text="${map.key}">íšŒì‚¬ëª…</p>
                    <p style="font-size: 30px; cursor: pointer; position: absolute; top: 4px; right: 20px" onclick="accordion()">âˆ§</p>

                    <div th:each="cartProduct, index:${map.value}" class="productList">
                        <!--productListë¥¼ ë°˜ë³µ ì‹œí‚¤ë©´ ë¨!!-->
                        <div class="productSelect">
                            <span onclick="cartProdDelete()">x</span>
                        </div>
                        <div class="productInfo">
                            <input type="checkbox" name="selectedCart" onclick="calculateTotalPrice()">
                            <input type="hidden" th:value="${cartProduct.cartProdNo}">
                            <a href="#"><img th:src="@{/uploads/__${cartProduct.thumb190}__}" alt="" style="width:80px"></a><!--80*80 ì‚¬ì´ì¦ˆë¡œ ë³€ê²½-->
                            <div>
                                <p><a href="#">[[${cartProduct.prodName}]]</a></p>
                                <p>[[${cartProduct.prodInfo}]]</p>
                                <p id="prodOpt" th:if="${cartProduct.optValue1 != null}">
                                    <span th:text="'ì˜µì…˜: ' + ${cartProduct.optValue1}"></span>
                                    <span th:if="${cartProduct.optValue2 != null}">
                                        <span th:text="' ) ' + ${cartProduct.optValue2}"></span>
                                        <span th:if="${cartProduct.optValue3 != null}">
                                        <span th:text="' / ' + ${cartProduct.optValue3}"></span>
                                    </span>
                                </span>
                                </p>
                                <p id="arrivalDate">4/17(ìˆ˜) ì´ë‚´ ë„ì°©í™•ë¥  86%</p>
                            </div>
                            <div>
                                <label for="">
                                    <button class="decrease" onclick="changeNum(-1)">-</button>
                                    <input class="prodCount" name="num" type="text" oninput="changeNum(0)" th:value="${cartProduct.count}">
                                    <button class="increase" onclick="changeNum(1)">+</button>
                                </label>
                            </div>
                            <div>
                                <!--í• ì¸ ì „ ê°€ê²© ì¶œë ¥ ì˜µì…˜ ìˆëŠ”ê²½ìš°/ ì—†ëŠ”ê²½ìš°-->
                                <p class="org_price" th:if="${cartProduct.optValue1}!= null">
                                    <span class="org_price_value" style="text-decoration: line-through; color: #7f7f7f" th:text="${#numbers.formatInteger(cartProduct.optPrice * cartProduct.count, 3, 'COMMA')}"></span>
                                    <span style="color: #ed2f2f; font-weight: bold" th:text="'â†“' + ${cartProduct.prodDiscount} + '%'"></span>
                                    <input class="price" type="hidden" th:value="${cartProduct.optPrice}">
                                </p>
                                <p class="org_price" th:if="${cartProduct.optValue1}== null">
                                    <span class="org_price_value" style="text-decoration: line-through; color: #7f7f7f" th:text="${#numbers.formatInteger(cartProduct.prodPrice * cartProduct.count , 3, 'COMMA')}"></span>
                                    <span style="color: #ed2f2f; font-weight: bold" th:text="'â†“' + ${cartProduct.prodDiscount} + '%'"></span>
                                    <input class="price" type="hidden" th:value="${cartProduct.prodPrice}">
                                </p>

                                <!--í• ì¸ í›„ ê°€ê²© ì¶œë ¥ ì˜µì…˜ ìˆëŠ”ê²½ìš°/ ì—†ëŠ”ê²½ìš°-->
                                <p class="dis_price" th:if="${cartProduct.optValue1} == null" th:text="${#numbers.formatInteger((cartProduct.prodPrice * (100 - cartProduct.prodDiscount) * cartProduct.count * 0.01), 3, 'COMMA')+'ì›'}"></p>
                                <p class="dis_price" th:if="${cartProduct.optValue1} != null" th:text="${#numbers.formatInteger((cartProduct.optPrice * (100 - cartProduct.prodDiscount) * cartProduct.count * 0.01), 3, 'COMMA')+'ì›'}"></p>
                                <input class="dis_prod" type="hidden" th:value="${cartProduct.prodDiscount}">
                                <input class="delivery_fee" type="hidden" th:value="${cartProduct.prodDeliveryFee}">
                                <a href="">í˜œíƒë³€ê²½</a>
                            </div>
                        </div>
                    </div>
                    <div style="border-top: 1px #d3d3d3 solid; padding: 10px;margin: 10px; font-size: 14px" class="company_price">
                        <span class="sum_org_price">ìƒí’ˆ 0ì›</span>
                        <span class="delivery_price"> + ë°°ì†¡ë¹„ 0ì›</span>
                        <span class="discount_price"> - í• ì¸ 0ì›</span>
                        <span class="total_price"> = ì´ 0ì›</span>
                    </div>
                </div>
            </div>

            <!-- ì¥ë°”êµ¬ë‹ˆ ì „ì²´í•©ê³„ -->
            <div class="total">
                <h2>ì „ì²´í•©ê³„</h2>
                <table border="0">
                    <tr>
                        <td>ìƒí’ˆìˆ˜</td>
                        <td id="prodCount">0</td>
                    </tr>
                    <tr>
                        <td>ìƒí’ˆê¸ˆì•¡</td>
                        <td id="prodOrgPrice">0</td>
                    </tr>
                    <tr>
                        <td>í• ì¸ê¸ˆì•¡</td>
                        <td id="prodDisPrice">- 0</td>
                    </tr>
                    <tr>
                        <td>ë°°ì†¡ë¹„</td>
                        <td id="prodDelivery">0</td>
                    </tr>
                    <tr>
                        <td>í¬ì¸íŠ¸</td>
                        <td id="prodPoint">0</td>
                    </tr>
                    <tr>
                        <td>ì „ì²´ì£¼ë¬¸ê¸ˆì•¡</td>
                        <td id="prodTotalPrice">0</td>
                    </tr>
                </table>
                <form id="buyForm" th:action="@{/product/order}" method="POST">
                    <input type="submit" id="btnOrder" value="ì£¼ë¬¸í•˜ê¸°">
                    <input type="hidden"  name="user" id="userForDirect" th:value="${#authentication.principal.user.userId}">
                    <input type="hidden" name="cartProdNo" id="selectedProd">
                </form>
            </div>

        </section>
        <!-- ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ ë -->
    </main>
    <footer>
        <ul>
            <li><a th:href="@{/company/index}">íšŒì‚¬ì†Œê°œ</a></li>
            <li><a th:href="@{/policy/buyer}">ì„œë¹„ìŠ¤ì´ìš©ì•½ê´€</a></li>
            <li><a th:href="@{/policy/privacy}">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a></li>
            <li><a th:href="@{/policy/finance}">ì „ìê¸ˆìœµê±°ë˜ì•½ê´€</a></li>
        </ul>
        <div>
            <p><img src="../images/footer_logo.png" alt="ë¡œê³ " /></p>
            <p>
                <strong>(ì£¼)ë¡¯ë°ON</strong><br />
                ì„œìš¸íŠ¹ë³„ì‹œ ì†¡íŒŒêµ¬ ì˜¬ë¦¼í”½ë¡œ 300 ë¡¯ë°ì›”ë“œíƒ€ì›Œ 26ì¸µ (ì—­ì‚¼ë™ ê°•ë‚¨íŒŒì´ë‚¸ìŠ¤ì„¼í„°)<br />
                ëŒ€í‘œì´ì‚¬ : ê¹€ì‚¬ë¬´ì—˜ìƒí˜„, ì •ì¤€í˜¸, ê°•ì„±í˜„<br />
                ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ : 529-85-00774(ë¡¯ë°ì‡¼í•‘(ì£¼) eì»¤ë¨¸ìŠ¤ì‚¬ì—…ë¶€)<br />
                í†µì‹ íŒë§¤ì—… ì‹ ê³  : ì„œìš¸ì†¡íŒŒ ì œ0158í˜¸<br>
                í˜¸ìŠ¤íŒ… ì„œë¹„ìŠ¤ì‚¬ì—…ì : ë¡¯ë°ì‡¼í•‘(ì£¼) eì»¤ë¨¸ìŠ¤ì‚¬ì—…ë¶€
            </p>
            <p>
                <strong>ê³ ê°ì„¼í„°</strong><br />
                Tel : 1899-7000(ìœ ë£Œ) (í‰ì¼ 09:00~18:00)<br />
                Fax : 051-123-4567 | E-mail : lotteon@lotte.net<br />
            </p>
        </div>
    </footer>
    <button type="button" id="top" onclick="movingTop()">ìƒë‹¨ì´ë™</button>
</div>
</body>
</html>


-->